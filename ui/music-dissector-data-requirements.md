# Music Dissector データ要件

## 概要
Music Dissectorは音楽分析結果を可視化するWebアプリケーションです。以下のデータが必要です。

## 必要なデータ構造

### 1. JSONデータ（圧縮形式: .json.gz）
各トラックごとに以下の構造のJSONファイルが必要：

```json
{
  "inferences": {
    "beats": [数値の配列],        // ビートのタイムスタンプ（秒）
    "downbeats": [数値の配列],    // ダウンビートのタイムスタンプ（秒）
    "segments": [数値の配列],      // セグメント境界のタイムスタンプ（秒）
    "labels": [文字列の配列]       // セグメントラベル（例: "intro", "verse", "chorus"）
  },
  "truths": {
    "beats": [数値の配列],        // 正解ビートのタイムスタンプ（秒）
    "downbeats": [数値の配列],    // 正解ダウンビートのタイムスタンプ（秒）
    "segments": [数値の配列],      // 正解セグメント境界のタイムスタンプ（秒）
    "labels": [文字列の配列]       // 正解セグメントラベル
  },
  "scores": {
    "beat": {
      "f1": 数値                  // ビート検出のF1スコア（0.0〜1.0）
    },
    "downbeat": {
      "f1": 数値                  // ダウンビート検出のF1スコア（0.0〜1.0）
    },
    "segment": {
      "F-measure@0.5": 数値,      // セグメント検出のF-measure（0.5秒許容）
      "Pairwise F-measure": 数値   // ラベルのペアワイズF-measure
    }
  },
  "nav": {
    "drum": [数値の配列],         // ドラムトラックのエネルギー値
    "bass": [数値の配列],         // ベーストラックのエネルギー値
    "vocal": [数値の配列],        // ボーカルトラックのエネルギー値
    "other": [数値の配列]         // その他トラックのエネルギー値
  },
  "wav": {
    "drum": [数値の配列],         // ドラムトラックの波形データ
    "bass": [数値の配列],         // ベーストラックの波形データ
    "vocal": [数値の配列],        // ボーカルトラックの波形データ
    "other": [数値の配列]         // その他トラックの波形データ
  }
}
```

### 2. 音声ファイル（MP3形式）

#### ミックスダウンファイル
- パス: `mixdown/{track_id}.mp3`
- 全ステムをミックスした完全な音声ファイル

#### ステムファイル（分離された音源）
- `demixed/{track_id}/drums.mp3` - ドラムトラック
- `demixed/{track_id}/bass.mp3` - ベーストラック
- `demixed/{track_id}/vocals.mp3` - ボーカルトラック
- `demixed/{track_id}/other.mp3` - その他の楽器トラック

## データ配置構造

```
data/
├── {track_id}.json.gz          # 分析結果JSON（圧縮）
├── mixdown/
│   └── {track_id}.mp3          # ミックスダウン音声
└── demixed/
    └── {track_id}/
        ├── drums.mp3           # ドラムステム
        ├── bass.mp3            # ベースステム
        ├── vocals.mp3          # ボーカルステム
        └── other.mp3           # その他ステム
```

## 重要な設定

- FPS: 100（1秒あたり100フレーム）
- WINDOW_SECONDS: 8（表示ウィンドウは8秒）
- BEAT_TOLERANCE: 0.07（ビート検出の許容誤差）

## 注意事項

1. JSONファイルはgzip圧縮されている必要があります（.json.gz）
2. 音声ファイルはMP3形式である必要があります
3. nav（ナビゲーター）とwav（波形）データは、FPS（100）に基づいたサンプリングレートで提供される必要があります
4. すべてのタイムスタンプは秒単位で指定します
